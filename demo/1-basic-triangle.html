<!DOCTYPE html>
<html>
<head>
    <title>1. Basic Triangle - Vertex & Fragment Shader</title>
</head>
<body>
    <h2>Konsep 1: Basic Triangle - Vertex & Fragment Shader</h2>
    <canvas id="canvas" width="600" height="400" style="border: 1px solid black;"></canvas>
    <br>
    <button onclick="changeColor()">Ganti Warna</button>
    <p>
        Vertex Shader: Menentukan posisi titik<br>
        Fragment Shader: Menentukan warna pixel
    </p>

    <script>
        // Vertex Shader - program per vertex
        const vsSource = `#version 300 es
            in vec4 aPosition;  // Input: posisi vertex
            
            void main() {
                gl_Position = aPosition;  // Output: posisi di clip space
            }
        `;

        // Fragment Shader - program per pixel
        const fsSource = `#version 300 es
            precision highp float;
            uniform vec4 uColor;  // Input: warna dari JavaScript
            out vec4 fragColor;   // Output: warna pixel
            
            void main() {
                fragColor = uColor;
            }
        `;

        let gl, program, colorLocation;
        let currentColor = [1.0, 0.0, 0.0, 1.0]; // Merah

        function createShader(gl, type, source) {
            const shader = gl.createShader(type);
            gl.shaderSource(shader, source);
            gl.compileShader(shader);
            
            if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
                console.error('Shader error:', gl.getShaderInfoLog(shader));
                gl.deleteShader(shader);
                return null;
            }
            return shader;
        }

        function init() {
            const canvas = document.getElementById('canvas');
            gl = canvas.getContext('webgl2');
            
            // Compile shaders
            const vertexShader = createShader(gl, gl.VERTEX_SHADER, vsSource);
            const fragmentShader = createShader(gl, gl.FRAGMENT_SHADER, fsSource);
            
            // Link program
            program = gl.createProgram();
            gl.attachShader(program, vertexShader);
            gl.attachShader(program, fragmentShader);
            gl.linkProgram(program);
            
            // Triangle vertices (x, y, z)
            const vertices = new Float32Array([
                 0.0,  0.5, 0.0,  // Atas
                -0.5, -0.5, 0.0,  // Kiri bawah
                 0.5, -0.5, 0.0   // Kanan bawah
            ]);
            
            // Create buffer
            const buffer = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
            gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);
            
            // Get attribute location
            const aPosition = gl.getAttribLocation(program, 'aPosition');
            gl.enableVertexAttribArray(aPosition);
            gl.vertexAttribPointer(aPosition, 3, gl.FLOAT, false, 0, 0);
            
            // Get uniform location
            colorLocation = gl.getUniformLocation(program, 'uColor');
            
            draw();
        }

        function draw() {
            gl.clearColor(0.9, 0.9, 0.9, 1.0);
            gl.clear(gl.COLOR_BUFFER_BIT);
            
            gl.useProgram(program);
            gl.uniform4fv(colorLocation, currentColor);
            gl.drawArrays(gl.TRIANGLES, 0, 3);
        }

        function changeColor() {
            // Cycle colors: Merah -> Hijau -> Biru -> Merah
            if (currentColor[0] === 1.0) {
                currentColor = [0.0, 1.0, 0.0, 1.0]; // Hijau
            } else if (currentColor[1] === 1.0) {
                currentColor = [0.0, 0.0, 1.0, 1.0]; // Biru
            } else {
                currentColor = [1.0, 0.0, 0.0, 1.0]; // Merah
            }
            draw();
        }

        init();
    </script>
</body>
</html>